<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Spartan Marketplace - UNCG Student Marketplace"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Spartan Marketplace</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- API Optimizer & Duplicate Message Preventer -->
    <script src="%PUBLIC_URL%/api-optimizer.js"></script>

    <!-- 
      TESTING: To reset message prevention, copy this script and paste it in the browser console:
      ---------------------------------------------------------------------------------------------
      
      fetch('/console-reset.js')
        .then(response => response.text())
        .then(script => {
          console.log('Loaded reset script');
          eval(script);
        })
        .catch(err => {
          console.error('Error loading reset script:', err);
        });
    -->

    <!-- 
      TESTING: To force send an initial message, copy this script and paste it in the browser console:
      -----------------------------------------------------------------------------------------------
      
      fetch('/force-send.js')
        .then(response => response.text())
        .then(script => {
          console.log('Loaded force send script');
          eval(script);
        })
        .catch(err => {
          console.error('Error loading force send script:', err);
        });
    -->

    <!-- 
      FIX FOR 400 BAD REQUEST ERRORS WHEN SENDING MESSAGES
      If you're experiencing 400 Bad Request errors when sending messages, run this in your browser console:
      
      fetch('/fix-400-error.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('‚úÖ 400 error fix loaded successfully');
          } catch (e) {
            console.error('‚ùå Error loading fix script:', e);
          }
        })
        .catch(err => console.error('‚ùå Failed to load the fix script:', err));
    -->

    <!-- 
      DEBUG TOOL - Find duplicate message issues
      Run this command in your browser console to analyze and fix duplicate message problems:
      
      fetch('/final-duplicate-fix.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('Duplicate message fix installed');
          } catch (e) {
            console.error('Error installing duplicate message fix:', e);
          }
        })
        .catch(err => console.error('Failed to load the duplicate fix script:', err));
    -->

    <!-- 
      NEW: ADVANCED DEBUG TOOL FOR 400 BAD REQUEST ERRORS
      Run this command to analyze your Supabase setup and find the right fix for your environment:
      
      fetch('/debug-send.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('Debug send tool loaded successfully');
          } catch (e) {
            console.error('Error loading debug send tool:', e);
          }
        })
        .catch(err => console.error('Failed to load the debug send tool:', err));
    -->

    <!-- 
      FIX FOR "BODY STREAM ALREADY READ" ERRORS
      Run this command if you are getting the error "body stream already read" with Supabase:
      
      fetch('/fix-stream-error.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('‚úÖ Stream error fix loaded successfully');
          } catch (e) {
            console.error('‚ùå Error loading stream error fix:', e);
          }
        })
        .catch(err => console.error('‚ùå Failed to load the stream error fix:', err));
    -->

    <!-- 
      FIX FOR PRODUCT INQUIRY IN CHAT
      Run this command if you want different products from the same seller to create separate inquiries:
      
      fetch('/product-inquiry-fix.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('‚úÖ Product inquiry fix loaded successfully');
          } catch (e) {
            console.error('‚ùå Error loading product inquiry fix:', e);
          }
        })
        .catch(err => console.error('‚ùå Failed to load the product inquiry fix:', err));
    -->

    <!-- 
      ADVANCED PRODUCT INQUIRY FIX 
      Use this if you're still having issues with the regular product inquiry fix:
      
      fetch('/advanced-inquiry-fix.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('‚úÖ Advanced product inquiry fix loaded successfully');
          } catch (e) {
            console.error('‚ùå Error loading advanced fix:', e);
          }
        })
        .catch(err => console.error('‚ùå Failed to load the advanced fix:', err));
    -->

    <!-- 
      DIRECT PRODUCT INQUIRY SENDER
      When all else fails, use this to directly send product inquiries through Supabase:
      
      fetch('/direct-send.js')
        .then(response => response.text())
        .then(code => {
          try {
            eval(code);
            console.log('‚úÖ Direct product inquiry sender loaded successfully');
          } catch (e) {
            console.error('‚ùå Error loading direct sender:', e);
          }
        })
        .catch(err => console.error('‚ùå Failed to load the direct sender:', err));
    -->

    <!-- PERMANENT FIX: Product Inquiry Fix - Automatically loaded -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for page to fully load before applying the fix
        setTimeout(() => {
          // Check if we're on a messaging or product page
          const url = window.location.href;
          if (
            url.includes("/message/") ||
            url.includes("/messaging/") ||
            url.includes("productId=") ||
            url.includes("/product/")
          ) {
            console.log(
              "üì± Message or product page detected - Loading inquiry fix automatically"
            );

            // First, load the Supabase loader script
            const supabaseLoaderScript = document.createElement("script");
            supabaseLoaderScript.src = "/supabase-loader.js";
            supabaseLoaderScript.onload = function () {
              console.log(
                "Supabase loader script loaded, waiting for initialization..."
              );

              // Wait for Supabase to be available before loading the direct-send script
              setTimeout(() => {
                // Create script element for the direct-send.js
                const script = document.createElement("script");
                script.src = "/direct-send.js";
                script.onload = function () {
                  console.log(
                    "‚úÖ Product inquiry fix loaded and activated automatically"
                  );
                };
                script.onerror = function () {
                  console.error("‚ùå Failed to load product inquiry fix");
                };

                // Add the script to the page
                document.head.appendChild(script);
              }, 1000); // Give Supabase loader time to initialize
            };

            // Add the Supabase loader script to the page
            document.head.appendChild(supabaseLoaderScript);
          }
        }, 1000);
      });
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
